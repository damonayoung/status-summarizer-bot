name: Publish Executive Brief to Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Ensure a public/ folder always exists with an index.html
      - name: Prepare site
        run: |
          mkdir -p public
          # If your generator writes a dated file, copy it to index.html for Pages
          if [ -f executive_command_brief_full_2025-10-24.html ]; then
            cp executive_command_brief_full_2025-10-24.html public/index.html
          elif [ -f executive_command_brief_2025-10-24.html ]; then
            cp executive_command_brief_2025-10-24.html public/index.html
          elif [ -f executive_dashboard_2025-10-24.html ]; then
            cp executive_dashboard_2025-10-24.html public/index.html
          else
            # Fallback: lightweight placeholder if nothing found
            cat > public/index.html <<'HTML'
            <!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"><title>Executive Brief</title></head>
            <body style="font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;padding:24px;max-width:900px;margin:auto">
              <h1>Executive Brief</h1>
              <p>No generated brief was found in the repository root. Ensure your run copies the latest HTML to <code>public/index.html</code>.</p>
            </body></html>
            HTML
          fi

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: public

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
